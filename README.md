# mlbtraj — wireframe Statcast trajectory toolkit

This project reconstructs 3D batted-ball trajectories from Baseball Savant CSV exports and bundles a Three.js viewer that renders MLB ballparks as wireframes while highlighting the flight path in colour.

## Features
- Python package `mlbtraj` with an argparse-based CLI
  - `mlbtraj simulate` converts filtered CSV rows into physics-based trajectories (gravity + drag + Magnus) and exports JSON/CSV artefacts
  - `mlbtraj bundle-viewer` copies the static viewer, trajectories, and configurable theme assets into a distributable directory
  - `mlbtraj --list-parks` enumerates park presets from `data/ballparks/registry.json`
- RK4 integrator with distance calibration (`--calibrate-distance`) to keep simulated carry within ±15 ft of Statcast `hit_distance_sc`
- Autogenerated playlist metadata sorted chronologically for easy playback
- Three.js viewer obeying the wireframe requirement: ballpark lines only, trajectory rendered with a thick coloured `Line2`, optional “follow ball” camera, and five camera presets (auto-generating IF High if missing)
- Theme overrides via `bundle-viewer --theme config/theme.json`

## Quick start
```bash
python -m pip install -e .
mlbtraj simulate data/samples/sample.csv --park lad-dodger-stadium --out out/lad --calibrate-distance
mlbtraj bundle-viewer --playlist out/lad/playlist.json --dest dist/lad --theme config/theme.json
python -m http.server --directory dist/lad 8080
```
Then open <http://localhost:8080> to explore the wireframe viewer. Use the toolbar to scrub through plays, adjust playback speed, switch camera presets (Catcher, IF High, LF/CF/RF stands), and optionally enable automatic follow mode that keeps the camera trained on the ball.

### Ballpark selection
- `--park <slug>` picks a preset from the registry (aliases such as `lad` work)
- `--park-file <path>` allows custom JSON
- `--auto-park` infers the park using CSV `venueId` or home team alias
- `mlbtraj --list-parks` prints the available presets

### Outputs
Running `mlbtraj simulate` produces:
- `playlist.json` — replay order plus metadata for the viewer
- `summary.csv` — human/tabular summary with measured launch metrics, simulated outcomes, drag scaling factor, apex, and flight time
- `trajectories/<play_id>.json` — per-play RK4 samples (`t`, `x`, `y`, `z` in feet)

The viewer bundle copies those artefacts alongside:
- `config.json` — merged theme, ballpark wireframe geometry, and camera presets
- `viewer/index.html`, `viewer/style.css`, `viewer/app.js`

## Development
- `pytest`, `ruff`, and `mypy` keep the CLI and viewer pipeline healthy:
  ```bash
  python -m pip install -e .[dev]
  pytest
  ruff check .
  mypy mlbtraj
  ```
- Source structure:
  - `mlbtraj/` — simulation engine, registry helpers, CLI
  - `data/ballparks/` — park registry and presets
  - `viewer/` — static viewer assets copied by `bundle-viewer`

## Licence
MIT
